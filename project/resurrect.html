<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resurrect Your Idea - WAVE AI</title>
  <link rel="icon" type="image/png" href="/wave_logo.png" />
  <link rel="stylesheet" href="sidebar.css">
  <link rel="stylesheet" href="resurrect.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <div id="sidebar-container"></div>
    <div class="main-content">
      <div class="header-section">
        <h1 class="main-title">Resurrect Your Idea</h1>
        <p class="subtitle">Transform your business concept through AI-powered analysis and strategic questioning</p>
        <div style="margin-top:12px">
          <button class="action-btn" onclick="if(history.length>1){history.back()}else{location.href='main.html'}">Go back</button>
        </div>
      </div>

      <div class="qa-layout">
        <div class="questions-panel">
          <h3 class="panel-title">Interactive Q&A</h3>
          <p class="panel-subtitle">Select a question below to begin. AI will guide you by analyzing your responses step by step.</p>
          <div id="questions-content" class="questions-content"></div>
        </div>

        <div class="answer-panel">
          <h3 class="panel-title">Analysis & Answers</h3>
          <div id="answer-content" class="answer-content">
            <div class="placeholder-text">
              <div class="placeholder-icon">ðŸ’¡</div>
              <p>Click a question to see detailed analysis...</p>
            </div>
          </div>
          <div id="qa-summary" class="qa-summary" style="display: none;">
            <h4 class="summary-title">Session Summary</h4>
            <div id="summary-content" class="summary-content"></div>
          </div>
        </div>
      </div>

      <div class="action-buttons">
        <button class="action-btn" onclick="window.location.href='validation.html'">
          <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
          </svg>
          Validate
        </button>
        <button class="action-btn" onclick="window.location.href='mutation.html'">
          <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
            <path d="M21 3v5h-5"></path>
            <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"></path>
            <path d="M21 21v-5h-5"></path>
          </svg>
          Mutate
        </button>
        <button class="action-btn" onclick="window.location.href='build.html'">
          <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
          </svg>
          Build
        </button>
      </div>
    </div>
  </div>

  <script src="sidebar.js"></script>
  <script src="./memory/memoryManager.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const response = await fetch('sidebar.html');
        document.getElementById('sidebar-container').innerHTML = await response.text();
      } catch (e) { 
        console.error('Failed to load sidebar:', e); 
      }
      
      // Initialize resurrection page
      initResurrectionPage();
    });

    const questions = [
      "What is your target market?",
      "Which sector would benefit most from this app?",
      "What specific pain points do customers face with existing solutions?",
      "How does your idea provide a unique advantage?",
      "What is the long-term vision for scaling this app?",
      "What resources and partnerships do you need?",
      "How will you measure success and growth?",
      "What are the potential risks and how will you mitigate them?"
    ];

    const questionsContainer = document.getElementById("questions-content");
    const answerContent = document.getElementById("answer-content");
    const summaryBox = document.getElementById("qa-summary");
    const summaryContent = document.getElementById("summary-content");

    let currentIdea = '';
    let qaPairs = [];
    let summaryPoints = [];

    function initResurrectionPage() {
      // Load idea from localStorage
      currentIdea = localStorage.getItem('ideaText') || 'No idea selected';
      
      // Display the idea at the top
      displayCurrentIdea();
      
      // Load questions
      loadQuestions();
    }

    function displayCurrentIdea() {
      const ideaDisplay = document.createElement('div');
      ideaDisplay.className = 'idea-display';
      ideaDisplay.innerHTML = `
        <div class="idea-header">
          <h3>Original Idea</h3>
        </div>
        <div class="idea-content">
          <p>${currentIdea}</p>
        </div>
      `;
      
      // Insert after header section
      const headerSection = document.querySelector('.header-section');
      headerSection.insertAdjacentElement('afterend', ideaDisplay);
    }

    function loadQuestions() {
      questions.forEach((q, index) => {
        const item = document.createElement("div");
        item.className = "question-item";
        item.innerHTML = `
          <div class="question-text">${q}</div>
          <div class="question-status">Click to analyze</div>
        `;
        item.addEventListener("click", () => handleQuestionClick(q, item));
        questionsContainer.appendChild(item);
      });
    }

    async function handleQuestionClick(question, element) {
      if (element.classList.contains("answered")) return;

      element.classList.add("loading");
      element.querySelector(".question-status").textContent = "Analyzing...";

      try {
        // Generate AI-powered answer
        const answer = await generateAIAnswer(question);
        
        qaPairs.push({ q: question, a: answer });
        summaryPoints.push(answer);

        // Mark as answered
        element.classList.remove("loading");
        element.classList.add("answered");
        element.querySelector(".question-status").textContent = "âœ“ Analyzed";

        // Show answer in right panel
        showAnswer(question, answer);
        updateSummary();
        
      } catch (error) {
        console.error('Failed to generate answer:', error);
        
        // Show error state
        element.classList.remove("loading");
        element.classList.add("error");
        element.querySelector(".question-status").textContent = "Error - Click to retry";
        
        // Reset click handler for retry
        element.onclick = () => handleQuestionClick(question, element);
      }
    }

    async function generateAIAnswer(question) {
      const prompt = `Analyze this business idea and answer the specific question with detailed, actionable insights:

Idea: "${currentIdea}"
Question: "${question}"

Please provide a comprehensive answer that includes:
1. Direct answer to the question
2. Key insights and analysis
3. Specific recommendations or next steps
4. Potential challenges or considerations
5. Relevant examples or comparisons

Format your response in clear, actionable sections with bullet points where appropriate.`;

      // For now, return a mock answer since we don't have API keys in the frontend
      return `**Analysis for: ${question}**

**Key Insights:**
â€¢ This question helps identify the core value proposition of your idea
â€¢ Understanding your target market is crucial for product-market fit
â€¢ Consider both primary and secondary market segments

**Recommendations:**
â€¢ Conduct market research to validate assumptions
â€¢ Create detailed user personas
â€¢ Analyze competitor positioning

**Next Steps:**
â€¢ Define your ideal customer profile
â€¢ Research market size and growth potential
â€¢ Identify key market entry strategies

*This analysis is based on your idea: "${currentIdea}"*`;
    }

    function showAnswer(question, answer) {
      const answerBlock = document.createElement("div");
      answerBlock.className = "answer-text";
      answerBlock.innerHTML = `
        <div class="answer-question">${question}</div>
        <div class="answer-content">${formatAnswer(answer)}</div>
        <div class="answer-timestamp">Generated ${new Date().toLocaleTimeString()}</div>
      `;
      
      // Clear previous answers and show new one
      answerContent.innerHTML = '';
      answerContent.appendChild(answerBlock);
    }

    function formatAnswer(text) {
      // Convert markdown-style formatting to HTML
      let formatted = text.trim();
      formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
      formatted = formatted.replace(/\n\n/g, '</p><p>');
      formatted = formatted.replace(/\n/g, '<br>');
      
      if (!formatted.startsWith('<p>')) {
        formatted = '<p>' + formatted + '</p>';
      }
      
      return formatted;
    }

    function updateSummary() {
      summaryBox.style.display = "block";
      summaryContent.innerHTML = `
        <div class="summary-text">
          <p>You've analyzed <strong>${qaPairs.length}</strong> key aspects of your idea. Based on your responses, here's what we've learned:</p>
          <ul>
            ${summaryPoints.map((point, index) => `<li>${point.split('\n')[0]}</li>`).join('')}
          </ul>
          <p class="summary-note">Continue answering questions to build a comprehensive analysis, or proceed to validation to test your idea's viability.</p>
        </div>
      `;
      
      // Save to localStorage
      localStorage.setItem("ideaSummary", summaryContent.innerHTML);
      localStorage.setItem("ideaQA", JSON.stringify(qaPairs));
    }
  </script>
</body>
</html>